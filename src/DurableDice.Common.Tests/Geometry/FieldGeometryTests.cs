using DurableDice.Common.Geometry;
using DurableDice.Common.Models.State;
using DurableDice.Common.Tests.Geometry.TestCases;
using Newtonsoft.Json;
using NUnit.Framework;

namespace DurableDice.Common.Tests.Geometry;

public class FieldGeometryTests
{
    [SetUp]
    public void Setup()
    {

    }

    [TestCaseSource(typeof(NeighboringFieldsTestCaseSource))]
    [TestCaseSource(typeof(CompoundNeighboringFieldsTestCaseSource))]
    public void NeighboringFieldsTest(Field field1, Field field2, bool areNeighbors)
    {
        field1.Id = "1";
        field2.Id = "2";

        var subject = new FieldGeometry(new[] { field1, field2 });

        Assert.AreEqual(areNeighbors, subject.AreNeighboringFields("1", "2"));
    }

    [TestCaseSource(typeof(FieldBlockSizeTestCaseSource))]
    [TestCaseSource(typeof(CompoundFieldBlockSizeTestCaseSource))]
    public void LargestContinuousFieldBlockTest(IEnumerable<Field> fields, int blocksize)
    {
        var id = 0;

        var ownedFields = fields.ToList();
        ownedFields.ForEach(x =>
        {
            x.Id = $"{++id}";
            x.OwnerId = "A";
        });

        var subject = new FieldGeometry(ownedFields);

        Assert.AreEqual(blocksize, subject.GetLargestContinuousFieldBlock("A"));
    }

    [TestCaseSource(typeof(FieldCircleTestCaseSource))]
    public void FieldCircleTest(Coordinate center, int radius, IEnumerable<Coordinate> expectedCoordinates)
    {
        var circle = FieldGeometry.GetCircleAroundCoordinate(center, radius);

        Assert.IsTrue(expectedCoordinates.Except(circle).Any() == false);
        Assert.IsTrue(circle.Except(expectedCoordinates).Any() == false);
    }

    [Test]
    public void EmptyContinuousFieldBlockTest()
    {
        var state = new GameState();

        var subject = new FieldGeometry(state.Fields);

        Assert.AreEqual(0, subject.GetLargestContinuousFieldBlock("X"));
    }

    [Test]
    public void RealContinuousFieldBlockTest()
    {
        var json = @"{""Players"":[{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""A"",""DiceBuffer"":0,""Ready"":true},{""Id"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6"",""Name"":""Q"",""DiceBuffer"":0,""Ready"":true},{""Id"":""905fea84-e074-4f37-aeea-3861d9248fb3"",""Name"":""W"",""DiceBuffer"":0,""Ready"":true},{""Id"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"",""Name"":""E"",""DiceBuffer"":0,""Ready"":true},{""Id"":""96fd4c7d-d029-48d0-beec-b098e8615c43"",""Name"":""R"",""DiceBuffer"":0,""Ready"":true},{""Id"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f"",""Name"":""T"",""DiceBuffer"":0,""Ready"":true},{""Id"":""7d424ecb-f1a0-4371-a80c-93741b88f07a"",""Name"":""Y"",""DiceBuffer"":0,""Ready"":true}],""Fields"":[{""Id"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f-1"",""OwnerId"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f"",""DiceCount"":6,""Coordinates"":[{""X"":10,""Y"":17},{""X"":10,""Y"":16},{""X"":10,""Y"":15},{""X"":9,""Y"":15},{""X"":9,""Y"":16},{""X"":11,""Y"":16},{""X"":11,""Y"":15},{""X"":8,""Y"":16},{""X"":8,""Y"":17},{""X"":9,""Y"":17},{""X"":8,""Y"":18},{""X"":9,""Y"":18},{""X"":10,""Y"":18},{""X"":10,""Y"":19},{""X"":11,""Y"":18},{""X"":11,""Y"":17},{""X"":12,""Y"":18},{""X"":12,""Y"":17},{""X"":12,""Y"":16}],""Center"":{""X"":10,""Y"":17}},{""Id"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f-0"",""OwnerId"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f"",""DiceCount"":7,""Coordinates"":[{""X"":14,""Y"":16},{""X"":14,""Y"":15},{""X"":14,""Y"":14},{""X"":13,""Y"":14},{""X"":13,""Y"":15},{""X"":15,""Y"":15},{""X"":15,""Y"":14},{""X"":12,""Y"":15},{""X"":13,""Y"":16},{""X"":13,""Y"":17},{""X"":14,""Y"":17},{""X"":14,""Y"":18},{""X"":15,""Y"":17},{""X"":15,""Y"":16},{""X"":16,""Y"":17},{""X"":16,""Y"":16},{""X"":16,""Y"":15}],""Center"":{""X"":14,""Y"":16}},{""Id"":""96fd4c7d-d029-48d0-beec-b098e8615c43-3"",""OwnerId"":""96fd4c7d-d029-48d0-beec-b098e8615c43"",""DiceCount"":3,""Coordinates"":[{""X"":7,""Y"":18},{""X"":7,""Y"":17},{""X"":6,""Y"":18},{""X"":6,""Y"":19},{""X"":7,""Y"":19},{""X"":8,""Y"":19}],""Center"":{""X"":7,""Y"":18}},{""Id"":""7d424ecb-f1a0-4371-a80c-93741b88f07a-2"",""OwnerId"":""7d424ecb-f1a0-4371-a80c-93741b88f07a"",""DiceCount"":4,""Coordinates"":[{""X"":5,""Y"":17},{""X"":5,""Y"":16},{""X"":4,""Y"":17},{""X"":4,""Y"":18},{""X"":5,""Y"":18},{""X"":6,""Y"":17}],""Center"":{""X"":5,""Y"":17}},{""Id"":""905fea84-e074-4f37-aeea-3861d9248fb3-2"",""OwnerId"":""905fea84-e074-4f37-aeea-3861d9248fb3"",""DiceCount"":2,""Coordinates"":[{""X"":18,""Y"":18},{""X"":18,""Y"":17},{""X"":18,""Y"":16},{""X"":17,""Y"":16},{""X"":17,""Y"":17},{""X"":19,""Y"":17},{""X"":19,""Y"":16},{""X"":16,""Y"":18},{""X"":17,""Y"":18},{""X"":16,""Y"":19},{""X"":17,""Y"":19},{""X"":18,""Y"":19},{""X"":19,""Y"":19},{""X"":19,""Y"":18},{""X"":20,""Y"":19},{""X"":20,""Y"":18},{""X"":20,""Y"":17}],""Center"":{""X"":18,""Y"":18}},{""Id"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e-2"",""OwnerId"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"",""DiceCount"":2,""Coordinates"":[{""X"":13,""Y"":18},{""X"":12,""Y"":19},{""X"":11,""Y"":19},{""X"":13,""Y"":19},{""X"":14,""Y"":19},{""X"":15,""Y"":19},{""X"":15,""Y"":18}],""Center"":{""X"":13,""Y"":18}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""96fd4c7d-d029-48d0-beec-b098e8615c43"",""DiceCount"":3,""Coordinates"":[{""X"":4,""Y"":19},{""X"":3,""Y"":18},{""X"":3,""Y"":19},{""X"":5,""Y"":19}],""Center"":{""X"":4,""Y"":19}},{""Id"":""7d424ecb-f1a0-4371-a80c-93741b88f07a-1"",""OwnerId"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f"",""DiceCount"":2,""Coordinates"":[{""X"":10,""Y"":14},{""X"":10,""Y"":13},{""X"":10,""Y"":12},{""X"":9,""Y"":12},{""X"":9,""Y"":13},{""X"":11,""Y"":13},{""X"":11,""Y"":12},{""X"":8,""Y"":13},{""X"":8,""Y"":14},{""X"":9,""Y"":14},{""X"":8,""Y"":15},{""X"":11,""Y"":14},{""X"":12,""Y"":14},{""X"":12,""Y"":13}],""Center"":{""X"":10,""Y"":14}},{""Id"":""96fd4c7d-d029-48d0-beec-b098e8615c43-0"",""OwnerId"":""96fd4c7d-d029-48d0-beec-b098e8615c43"",""DiceCount"":2,""Coordinates"":[{""X"":17,""Y"":15},{""X"":17,""Y"":14},{""X"":17,""Y"":13},{""X"":16,""Y"":14},{""X"":18,""Y"":15},{""X"":18,""Y"":14},{""X"":19,""Y"":15},{""X"":19,""Y"":14}],""Center"":{""X"":17,""Y"":15}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":3,""Coordinates"":[{""X"":6,""Y"":12},{""X"":6,""Y"":11},{""X"":6,""Y"":10},{""X"":5,""Y"":10},{""X"":5,""Y"":11},{""X"":7,""Y"":11},{""X"":7,""Y"":10},{""X"":4,""Y"":11},{""X"":4,""Y"":12},{""X"":5,""Y"":12},{""X"":4,""Y"":13},{""X"":5,""Y"":13},{""X"":6,""Y"":13},{""X"":6,""Y"":14},{""X"":7,""Y"":13},{""X"":7,""Y"":12},{""X"":8,""Y"":12},{""X"":8,""Y"":11}],""Center"":{""X"":6,""Y"":12}},{""Id"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e-3"",""OwnerId"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"",""DiceCount"":2,""Coordinates"":[{""X"":19,""Y"":13},{""X"":19,""Y"":12},{""X"":19,""Y"":11},{""X"":18,""Y"":12},{""X"":18,""Y"":13},{""X"":20,""Y"":13},{""X"":20,""Y"":12},{""X"":17,""Y"":12},{""X"":20,""Y"":15},{""X"":20,""Y"":14},{""X"":21,""Y"":14},{""X"":21,""Y"":13},{""X"":21,""Y"":12}],""Center"":{""X"":19,""Y"":13}},{""Id"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6-2"",""OwnerId"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f"",""DiceCount"":2,""Coordinates"":[{""X"":6,""Y"":16},{""X"":6,""Y"":15},{""X"":5,""Y"":14},{""X"":5,""Y"":15},{""X"":7,""Y"":15},{""X"":7,""Y"":14},{""X"":4,""Y"":15},{""X"":4,""Y"":16},{""X"":7,""Y"":16}],""Center"":{""X"":6,""Y"":16}},{""Id"":""905fea84-e074-4f37-aeea-3861d9248fb3-3"",""OwnerId"":""905fea84-e074-4f37-aeea-3861d9248fb3"",""DiceCount"":1,""Coordinates"":[{""X"":23,""Y"":14},{""X"":23,""Y"":13},{""X"":23,""Y"":12},{""X"":22,""Y"":13},{""X"":22,""Y"":14},{""X"":24,""Y"":14},{""X"":24,""Y"":13},{""X"":22,""Y"":15},{""X"":21,""Y"":15},{""X"":22,""Y"":16},{""X"":23,""Y"":15},{""X"":23,""Y"":16},{""X"":24,""Y"":16},{""X"":24,""Y"":15},{""X"":25,""Y"":15},{""X"":25,""Y"":14},{""X"":25,""Y"":13}],""Center"":{""X"":23,""Y"":14}},{""Id"":""96fd4c7d-d029-48d0-beec-b098e8615c43-2"",""OwnerId"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6"",""DiceCount"":1,""Coordinates"":[{""X"":16,""Y"":12},{""X"":16,""Y"":11},{""X"":15,""Y"":11},{""X"":15,""Y"":12},{""X"":16,""Y"":13},{""X"":17,""Y"":11}],""Center"":{""X"":16,""Y"":12}},{""Id"":""905fea84-e074-4f37-aeea-3861d9248fb3-1"",""OwnerId"":""905fea84-e074-4f37-aeea-3861d9248fb3"",""DiceCount"":2,""Coordinates"":[{""X"":22,""Y"":19},{""X"":22,""Y"":18},{""X"":22,""Y"":17},{""X"":21,""Y"":17},{""X"":21,""Y"":18},{""X"":23,""Y"":18},{""X"":23,""Y"":17},{""X"":21,""Y"":19},{""X"":23,""Y"":19},{""X"":24,""Y"":19},{""X"":24,""Y"":18}],""Center"":{""X"":22,""Y"":19}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":21,""Y"":16},{""X"":20,""Y"":16}],""Center"":{""X"":21,""Y"":16}},{""Id"":""905fea84-e074-4f37-aeea-3861d9248fb3-0"",""OwnerId"":""905fea84-e074-4f37-aeea-3861d9248fb3"",""DiceCount"":3,""Coordinates"":[{""X"":25,""Y"":17},{""X"":25,""Y"":16},{""X"":24,""Y"":17},{""X"":25,""Y"":18},{""X"":26,""Y"":18},{""X"":26,""Y"":17}],""Center"":{""X"":25,""Y"":17}},{""Id"":""7d424ecb-f1a0-4371-a80c-93741b88f07a-0"",""OwnerId"":""7d424ecb-f1a0-4371-a80c-93741b88f07a"",""DiceCount"":3,""Coordinates"":[{""X"":25,""Y"":19},{""X"":26,""Y"":19},{""X"":27,""Y"":19},{""X"":27,""Y"":18}],""Center"":{""X"":25,""Y"":19}},{""Id"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6-1"",""OwnerId"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6"",""DiceCount"":4,""Coordinates"":[{""X"":27,""Y"":16},{""X"":27,""Y"":15},{""X"":26,""Y"":16},{""X"":27,""Y"":17},{""X"":28,""Y"":17},{""X"":28,""Y"":16}],""Center"":{""X"":27,""Y"":16}},{""Id"":""96fd4c7d-d029-48d0-beec-b098e8615c43-1"",""OwnerId"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"",""DiceCount"":3,""Coordinates"":[{""X"":2,""Y"":10},{""X"":2,""Y"":9},{""X"":2,""Y"":8},{""X"":1,""Y"":8},{""X"":1,""Y"":9},{""X"":3,""Y"":9},{""X"":3,""Y"":8},{""X"":0,""Y"":9},{""X"":0,""Y"":10},{""X"":1,""Y"":10},{""X"":0,""Y"":11},{""X"":1,""Y"":11},{""X"":2,""Y"":11},{""X"":2,""Y"":12},{""X"":3,""Y"":11},{""X"":3,""Y"":10},{""X"":4,""Y"":10},{""X"":4,""Y"":9}],""Center"":{""X"":2,""Y"":10}},{""Id"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6-0"",""OwnerId"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6"",""DiceCount"":2,""Coordinates"":[{""X"":15,""Y"":10},{""X"":15,""Y"":9},{""X"":15,""Y"":8},{""X"":14,""Y"":9},{""X"":14,""Y"":10},{""X"":16,""Y"":10},{""X"":16,""Y"":9},{""X"":13,""Y"":9},{""X"":13,""Y"":10},{""X"":14,""Y"":11},{""X"":13,""Y"":11},{""X"":14,""Y"":12},{""X"":17,""Y"":10},{""X"":17,""Y"":9}],""Center"":{""X"":15,""Y"":10}},{""Id"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f-2"",""OwnerId"":""905fea84-e074-4f37-aeea-3861d9248fb3"",""DiceCount"":8,""Coordinates"":[{""X"":23,""Y"":11},{""X"":23,""Y"":10},{""X"":23,""Y"":9},{""X"":22,""Y"":10},{""X"":22,""Y"":11},{""X"":24,""Y"":11},{""X"":24,""Y"":10},{""X"":21,""Y"":10},{""X"":21,""Y"":11},{""X"":22,""Y"":12},{""X"":24,""Y"":12},{""X"":25,""Y"":12},{""X"":25,""Y"":11},{""X"":25,""Y"":10}],""Center"":{""X"":23,""Y"":11}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":26,""Y"":13},{""X"":26,""Y"":12},{""X"":26,""Y"":14},{""X"":27,""Y"":13},{""X"":27,""Y"":12}],""Center"":{""X"":26,""Y"":13}},{""Id"":""7d424ecb-f1a0-4371-a80c-93741b88f07a-3"",""OwnerId"":""7d424ecb-f1a0-4371-a80c-93741b88f07a"",""DiceCount"":1,""Coordinates"":[{""X"":5,""Y"":9},{""X"":5,""Y"":8},{""X"":6,""Y"":9}],""Center"":{""X"":5,""Y"":9}},{""Id"":""dd8200b5-2699-42d7-a9a2-de38f1c706a6-3"",""OwnerId"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"",""DiceCount"":1,""Coordinates"":[{""X"":2,""Y"":13},{""X"":1,""Y"":12},{""X"":1,""Y"":13},{""X"":2,""Y"":14},{""X"":3,""Y"":13},{""X"":3,""Y"":12}],""Center"":{""X"":2,""Y"":13}},{""Id"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f-3"",""OwnerId"":""4d601f6c-4a20-4d12-a603-cea8ae42f74f"",""DiceCount"":1,""Coordinates"":[{""X"":28,""Y"":15},{""X"":28,""Y"":14},{""X"":27,""Y"":14},{""X"":29,""Y"":15},{""X"":29,""Y"":14}],""Center"":{""X"":28,""Y"":15}},{""Id"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e-0"",""OwnerId"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"",""DiceCount"":1,""Coordinates"":[{""X"":20,""Y"":11},{""X"":20,""Y"":10},{""X"":19,""Y"":10}],""Center"":{""X"":20,""Y"":11}},{""Id"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e-1"",""OwnerId"":""8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"",""DiceCount"":2,""Coordinates"":[{""X"":2,""Y"":15},{""X"":1,""Y"":14},{""X"":1,""Y"":15},{""X"":2,""Y"":16},{""X"":3,""Y"":15},{""X"":3,""Y"":14}],""Center"":{""X"":2,""Y"":15}}],""ActivePlayerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""State"":0}";

        var state = JsonConvert.DeserializeObject<GameState>(json);

        var subject = new FieldGeometry(state.Fields);

        Assert.AreEqual(1, subject.GetLargestContinuousFieldBlock("01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"));
        Assert.AreEqual(2, subject.GetLargestContinuousFieldBlock("dd8200b5-2699-42d7-a9a2-de38f1c706a6"));
        Assert.AreEqual(5, subject.GetLargestContinuousFieldBlock("905fea84-e074-4f37-aeea-3861d9248fb3"));
        Assert.AreEqual(3, subject.GetLargestContinuousFieldBlock("8904c1ab-8f27-4dc6-baa2-291b8a6eb32e"));
        Assert.AreEqual(2, subject.GetLargestContinuousFieldBlock("96fd4c7d-d029-48d0-beec-b098e8615c43"));
        Assert.AreEqual(4, subject.GetLargestContinuousFieldBlock("4d601f6c-4a20-4d12-a603-cea8ae42f74f"));
        Assert.AreEqual(1, subject.GetLargestContinuousFieldBlock("7d424ecb-f1a0-4371-a80c-93741b88f07a"));
    }

    [Test]
    public void MassiveContinuousFieldBlockTest()
    {
        var json = @"{""Players"":[{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""A"",""DiceBuffer"":0,""Ready"":true},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""Q"",""DiceBuffer"":0,""Ready"":true},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""W"",""DiceBuffer"":0,""Ready"":true},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""E"",""DiceBuffer"":0,""Ready"":true},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""R"",""DiceBuffer"":0,""Ready"":true},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""T"",""DiceBuffer"":0,""Ready"":true},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""Name"":""Y"",""DiceBuffer"":0,""Ready"":true}],""Fields"":[{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":6,""Coordinates"":[{""X"":10,""Y"":17},{""X"":10,""Y"":16},{""X"":10,""Y"":15},{""X"":9,""Y"":15},{""X"":9,""Y"":16},{""X"":11,""Y"":16},{""X"":11,""Y"":15},{""X"":8,""Y"":16},{""X"":8,""Y"":17},{""X"":9,""Y"":17},{""X"":8,""Y"":18},{""X"":9,""Y"":18},{""X"":10,""Y"":18},{""X"":10,""Y"":19},{""X"":11,""Y"":18},{""X"":11,""Y"":17},{""X"":12,""Y"":18},{""X"":12,""Y"":17},{""X"":12,""Y"":16}],""Center"":{""X"":10,""Y"":17}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":7,""Coordinates"":[{""X"":14,""Y"":16},{""X"":14,""Y"":15},{""X"":14,""Y"":14},{""X"":13,""Y"":14},{""X"":13,""Y"":15},{""X"":15,""Y"":15},{""X"":15,""Y"":14},{""X"":12,""Y"":15},{""X"":13,""Y"":16},{""X"":13,""Y"":17},{""X"":14,""Y"":17},{""X"":14,""Y"":18},{""X"":15,""Y"":17},{""X"":15,""Y"":16},{""X"":16,""Y"":17},{""X"":16,""Y"":16},{""X"":16,""Y"":15}],""Center"":{""X"":14,""Y"":16}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":3,""Coordinates"":[{""X"":7,""Y"":18},{""X"":7,""Y"":17},{""X"":6,""Y"":18},{""X"":6,""Y"":19},{""X"":7,""Y"":19},{""X"":8,""Y"":19}],""Center"":{""X"":7,""Y"":18}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":4,""Coordinates"":[{""X"":5,""Y"":17},{""X"":5,""Y"":16},{""X"":4,""Y"":17},{""X"":4,""Y"":18},{""X"":5,""Y"":18},{""X"":6,""Y"":17}],""Center"":{""X"":5,""Y"":17}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":18,""Y"":18},{""X"":18,""Y"":17},{""X"":18,""Y"":16},{""X"":17,""Y"":16},{""X"":17,""Y"":17},{""X"":19,""Y"":17},{""X"":19,""Y"":16},{""X"":16,""Y"":18},{""X"":17,""Y"":18},{""X"":16,""Y"":19},{""X"":17,""Y"":19},{""X"":18,""Y"":19},{""X"":19,""Y"":19},{""X"":19,""Y"":18},{""X"":20,""Y"":19},{""X"":20,""Y"":18},{""X"":20,""Y"":17}],""Center"":{""X"":18,""Y"":18}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":13,""Y"":18},{""X"":12,""Y"":19},{""X"":11,""Y"":19},{""X"":13,""Y"":19},{""X"":14,""Y"":19},{""X"":15,""Y"":19},{""X"":15,""Y"":18}],""Center"":{""X"":13,""Y"":18}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":3,""Coordinates"":[{""X"":4,""Y"":19},{""X"":3,""Y"":18},{""X"":3,""Y"":19},{""X"":5,""Y"":19}],""Center"":{""X"":4,""Y"":19}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":10,""Y"":14},{""X"":10,""Y"":13},{""X"":10,""Y"":12},{""X"":9,""Y"":12},{""X"":9,""Y"":13},{""X"":11,""Y"":13},{""X"":11,""Y"":12},{""X"":8,""Y"":13},{""X"":8,""Y"":14},{""X"":9,""Y"":14},{""X"":8,""Y"":15},{""X"":11,""Y"":14},{""X"":12,""Y"":14},{""X"":12,""Y"":13}],""Center"":{""X"":10,""Y"":14}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":17,""Y"":15},{""X"":17,""Y"":14},{""X"":17,""Y"":13},{""X"":16,""Y"":14},{""X"":18,""Y"":15},{""X"":18,""Y"":14},{""X"":19,""Y"":15},{""X"":19,""Y"":14}],""Center"":{""X"":17,""Y"":15}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":3,""Coordinates"":[{""X"":6,""Y"":12},{""X"":6,""Y"":11},{""X"":6,""Y"":10},{""X"":5,""Y"":10},{""X"":5,""Y"":11},{""X"":7,""Y"":11},{""X"":7,""Y"":10},{""X"":4,""Y"":11},{""X"":4,""Y"":12},{""X"":5,""Y"":12},{""X"":4,""Y"":13},{""X"":5,""Y"":13},{""X"":6,""Y"":13},{""X"":6,""Y"":14},{""X"":7,""Y"":13},{""X"":7,""Y"":12},{""X"":8,""Y"":12},{""X"":8,""Y"":11}],""Center"":{""X"":6,""Y"":12}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":19,""Y"":13},{""X"":19,""Y"":12},{""X"":19,""Y"":11},{""X"":18,""Y"":12},{""X"":18,""Y"":13},{""X"":20,""Y"":13},{""X"":20,""Y"":12},{""X"":17,""Y"":12},{""X"":20,""Y"":15},{""X"":20,""Y"":14},{""X"":21,""Y"":14},{""X"":21,""Y"":13},{""X"":21,""Y"":12}],""Center"":{""X"":19,""Y"":13}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":6,""Y"":16},{""X"":6,""Y"":15},{""X"":5,""Y"":14},{""X"":5,""Y"":15},{""X"":7,""Y"":15},{""X"":7,""Y"":14},{""X"":4,""Y"":15},{""X"":4,""Y"":16},{""X"":7,""Y"":16}],""Center"":{""X"":6,""Y"":16}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":1,""Coordinates"":[{""X"":23,""Y"":14},{""X"":23,""Y"":13},{""X"":23,""Y"":12},{""X"":22,""Y"":13},{""X"":22,""Y"":14},{""X"":24,""Y"":14},{""X"":24,""Y"":13},{""X"":22,""Y"":15},{""X"":21,""Y"":15},{""X"":22,""Y"":16},{""X"":23,""Y"":15},{""X"":23,""Y"":16},{""X"":24,""Y"":16},{""X"":24,""Y"":15},{""X"":25,""Y"":15},{""X"":25,""Y"":14},{""X"":25,""Y"":13}],""Center"":{""X"":23,""Y"":14}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":1,""Coordinates"":[{""X"":16,""Y"":12},{""X"":16,""Y"":11},{""X"":15,""Y"":11},{""X"":15,""Y"":12},{""X"":16,""Y"":13},{""X"":17,""Y"":11}],""Center"":{""X"":16,""Y"":12}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":22,""Y"":19},{""X"":22,""Y"":18},{""X"":22,""Y"":17},{""X"":21,""Y"":17},{""X"":21,""Y"":18},{""X"":23,""Y"":18},{""X"":23,""Y"":17},{""X"":21,""Y"":19},{""X"":23,""Y"":19},{""X"":24,""Y"":19},{""X"":24,""Y"":18}],""Center"":{""X"":22,""Y"":19}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":21,""Y"":16},{""X"":20,""Y"":16}],""Center"":{""X"":21,""Y"":16}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":3,""Coordinates"":[{""X"":25,""Y"":17},{""X"":25,""Y"":16},{""X"":24,""Y"":17},{""X"":25,""Y"":18},{""X"":26,""Y"":18},{""X"":26,""Y"":17}],""Center"":{""X"":25,""Y"":17}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":3,""Coordinates"":[{""X"":25,""Y"":19},{""X"":26,""Y"":19},{""X"":27,""Y"":19},{""X"":27,""Y"":18}],""Center"":{""X"":25,""Y"":19}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":4,""Coordinates"":[{""X"":27,""Y"":16},{""X"":27,""Y"":15},{""X"":26,""Y"":16},{""X"":27,""Y"":17},{""X"":28,""Y"":17},{""X"":28,""Y"":16}],""Center"":{""X"":27,""Y"":16}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":3,""Coordinates"":[{""X"":2,""Y"":10},{""X"":2,""Y"":9},{""X"":2,""Y"":8},{""X"":1,""Y"":8},{""X"":1,""Y"":9},{""X"":3,""Y"":9},{""X"":3,""Y"":8},{""X"":0,""Y"":9},{""X"":0,""Y"":10},{""X"":1,""Y"":10},{""X"":0,""Y"":11},{""X"":1,""Y"":11},{""X"":2,""Y"":11},{""X"":2,""Y"":12},{""X"":3,""Y"":11},{""X"":3,""Y"":10},{""X"":4,""Y"":10},{""X"":4,""Y"":9}],""Center"":{""X"":2,""Y"":10}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":15,""Y"":10},{""X"":15,""Y"":9},{""X"":15,""Y"":8},{""X"":14,""Y"":9},{""X"":14,""Y"":10},{""X"":16,""Y"":10},{""X"":16,""Y"":9},{""X"":13,""Y"":9},{""X"":13,""Y"":10},{""X"":14,""Y"":11},{""X"":13,""Y"":11},{""X"":14,""Y"":12},{""X"":17,""Y"":10},{""X"":17,""Y"":9}],""Center"":{""X"":15,""Y"":10}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-2"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":8,""Coordinates"":[{""X"":23,""Y"":11},{""X"":23,""Y"":10},{""X"":23,""Y"":9},{""X"":22,""Y"":10},{""X"":22,""Y"":11},{""X"":24,""Y"":11},{""X"":24,""Y"":10},{""X"":21,""Y"":10},{""X"":21,""Y"":11},{""X"":22,""Y"":12},{""X"":24,""Y"":12},{""X"":25,""Y"":12},{""X"":25,""Y"":11},{""X"":25,""Y"":10}],""Center"":{""X"":23,""Y"":11}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":26,""Y"":13},{""X"":26,""Y"":12},{""X"":26,""Y"":14},{""X"":27,""Y"":13},{""X"":27,""Y"":12}],""Center"":{""X"":26,""Y"":13}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":1,""Coordinates"":[{""X"":5,""Y"":9},{""X"":5,""Y"":8},{""X"":6,""Y"":9}],""Center"":{""X"":5,""Y"":9}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":1,""Coordinates"":[{""X"":2,""Y"":13},{""X"":1,""Y"":12},{""X"":1,""Y"":13},{""X"":2,""Y"":14},{""X"":3,""Y"":13},{""X"":3,""Y"":12}],""Center"":{""X"":2,""Y"":13}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-3"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":1,""Coordinates"":[{""X"":28,""Y"":15},{""X"":28,""Y"":14},{""X"":27,""Y"":14},{""X"":29,""Y"":15},{""X"":29,""Y"":14}],""Center"":{""X"":28,""Y"":15}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-0"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":1,""Coordinates"":[{""X"":20,""Y"":11},{""X"":20,""Y"":10},{""X"":19,""Y"":10}],""Center"":{""X"":20,""Y"":11}},{""Id"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5-1"",""OwnerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""DiceCount"":2,""Coordinates"":[{""X"":2,""Y"":15},{""X"":1,""Y"":14},{""X"":1,""Y"":15},{""X"":2,""Y"":16},{""X"":3,""Y"":15},{""X"":3,""Y"":14}],""Center"":{""X"":2,""Y"":15}}],""ActivePlayerId"":""01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"",""State"":0}";

        var state = JsonConvert.DeserializeObject<GameState>(json);

        state.Fields.ForEach(field => field.Id = Guid.NewGuid().ToString());

        var subject = new FieldGeometry(state.Fields);

        Assert.AreEqual(28, subject.GetLargestContinuousFieldBlock("01f8c6ed-baf1-449a-ba7e-6a0f1f7d28d5"));
    }
}

